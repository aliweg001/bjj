{% extends "base.html" %}

{% block title %}{{ technique.name }} - BJJ Techniques Manager{% endblock %}

{% block content %}
<a href="{{ url_for('techniques') }}" style="color: #667eea; text-decoration: none; margin-bottom: 20px; display: inline-block;">
    ← Powrót do listy technik
</a>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
        <div>
            <h2 style="color: #667eea; margin-bottom: 10px;">{{ technique.name }}</h2>
            <!-- USUNIĘTY BADGE Z TUTAJ -->
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
        <!-- ZMIANA: dodaliśmy trzecią kolumnę dla poziomu trudności -->
        <div>
            <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Kategoria:</p>
            <p style="font-weight: 600;">{{ technique.category_name or 'Brak kategorii' }}</p>
        </div>
        <div>
            <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Pozycja:</p>
            <p style="font-weight: 600;">{{ technique.position or 'Nie określono' }}</p>
        </div>
        <div>
            <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Poziom trudności:</p>
            <p style="font-weight: 600; text-transform: capitalize;">
                {{ technique.difficulty or 'Nie określono' }}
            </p>
        </div>
    </div>

    <!-- Opis techniki przeniesiony na dół -->
</div>

<div class="card" style="margin-top: 30px;">
    <h3 style="margin-bottom: 20px;">Filmy treningowe ({{ videos|length }})</h3>

    {% if videos %}
        {% for video in videos %}
        <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                    <h4 style="margin-bottom: 5px;">
                        {% if video.video_type == 'youtube' %}
                            YouTube: {{ technique.name }}
                        {% else %}
                            {{ technique.name }} - Nagranie
                        {% endif %}
                    </h4>
                    <p style="font-size: 12px; color: #999;">
                        Typ: <strong>{{ video.video_type }}</strong> |
                        Przesłane przez: <strong>{{ video.username }}</strong> |
                        Data: <strong>{{ video.uploaded_at.strftime('%Y-%m-%d') if video.uploaded_at else 'Brak daty' }}</strong>
                    </p>
                </div>
            </div>

            <div style="max-width: 800px; margin: 0 auto;">
                {% if video.video_type == 'youtube' %}
                    {# Dla YouTube: wyodrębnij ID z URL i użyj embed #}
                    {% set youtube_id = video.filename|youtube_id %}
                    {% if youtube_id %}
                        <div style="position: relative; width: 100%; padding-bottom: 56.25%; border-radius: 8px; overflow: hidden; background: #000;">
                            <iframe 
                                src="https://www.youtube.com/embed/{{ youtube_id }}"
                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen
                                title="YouTube video player">
                            </iframe>
                        </div>
                    {% else %}
                        <p style="color: #e53e3e; padding: 10px; background: #fed7d7; border-radius: 6px;">
                            Nieprawidłowy link YouTube: {{ video.filename }}
                        </p>
                    {% endif %}
                {% else %}
                    {# Dla lokalnych filmów #}
                    <div style="border-radius: 8px; overflow: hidden; background: #000;">
                        <video controls style="width: 100%; display: block;">
                            <source src="{{ url_for('static', filename='uploads/' + video.filename) }}" type="video/mp4">
                            Twoja przeglądarka nie obsługuje odtwarzania wideo.
                        </video>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- OPIS TECHNIKI PRZENIESIONY TUTAJ, POD FILMAMI -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            <h3 style="margin-bottom: 15px;">Opis techniki</h3>
            <p style="color: #666; line-height: 1.6; white-space: pre-wrap; background: #f7fafc; padding: 20px; border-radius: 8px;">
                {{ technique.description or 'Brak opisu' }}
            </p>
        </div>

    {% else %}
        <p style="text-align: center; color: #999; padding: 40px;">
            Brak filmów dla tej techniki. Bądź pierwszy i prześlij nagranie!
        </p>

        <!-- OPIS TECHNIKI TAKŻE DLA PRZYPADKU BRAKU FILMÓW -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            <h3 style="margin-bottom: 15px;">Opis techniki</h3>
            <p style="color: #666; line-height: 1.6; white-space: pre-wrap; background: #f7fafc; padding: 20px; border-radius: 8px;">
                {{ technique.description or 'Brak opisu' }}
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}