{% extends "base.html" %}

{% block title %}Dashboard - BJJ Techniques Manager{% endblock %}

{% block content %}
<h2 style="margin-bottom: 30px;">Dashboard</h2>

<!-- Statystyki -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
        <h3 style="font-size: 32px; color: #667eea; margin-bottom: 10px;">{{ total_techniques }}</h3>
        <p style="color: #666; font-size: 14px;">Technik w bazie</p>
    </div>

    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
        <h3 style="font-size: 32px; color: #667eea; margin-bottom: 10px;">{{ total_videos }}</h3>
        <p style="color: #666; font-size: 14px;">Film√≥w treningowych</p>
    </div>

    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
        <h3 style="font-size: 32px; color: #667eea; margin-bottom: 10px;">{{ categories|length }}</h3>
        <p style="color: #666; font-size: 14px;">Kategorii</p>
    </div>
</div>

<!-- Ostatnie filmy -->
<h3 style="margin-bottom: 20px; color: #333;">Ostatnio dodane filmy</h3>
{% if recent_videos %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px;">
    {% for video in recent_videos %}
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h4 style="margin-bottom: 10px; color: #667eea;">
            {% if video.technique_name %}
                {{ video.technique_name }}
            {% else %}
                Film #{{ video.id }}
            {% endif %}
        </h4>

        <!-- Wy≈õwietlanie filmu w zale≈ºno≈õci od typu -->
        {% if video.video_type == 'youtube' %}
            <!-- YouTube - RZECZYWISTA miniaturka -->
            <div style="position: relative; overflow: hidden; border-radius: 5px; margin-bottom: 10px;">
                <a href="{{ video.filename }}" target="_blank" style="text-decoration: none; color: inherit; display: block;">
                    {% if video.filename and ('youtube.com' in video.filename or 'youtu.be' in video.filename) %}
                        <!-- Wyodrƒôbnij ID z YouTube -->
                        {% set yt_id = video.filename.split('v=')[1].split('&')[0] if 'v=' in video.filename else video.filename.split('/')[-1] %}
                        <img src="https://img.youtube.com/vi/{{ yt_id }}/mqdefault.jpg"
                             alt="Miniatura YouTube"
                             style="width: 100%; height: 180px; object-fit: cover; border-radius: 5px;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 0, 0, 0.8); color: white; width: 60px; height: 40px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            ‚ñ∂
                        </div>
                    {% else %}
                        <!-- Fallback je≈õli nie YouTube -->
                        <div style="background: #f0f0f0; height: 150px; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; color: #ff0000; margin-bottom: 10px;">‚ñ∂</div>
                                <p style="color: #333; font-size: 14px; margin: 0;">YouTube Video</p>
                            </div>
                        </div>
                    {% endif %}
                </a>
            </div>
            <p style="color: #666; font-size: 12px; margin-bottom: 15px;">
                <i>Link do YouTube</i>
            </p>

        {% elif video.video_type == 'training' %}
            <!-- Uploadowany film - RZECZYWISTY podglƒÖd -->
            <div style="position: relative; overflow: hidden; border-radius: 5px; margin-bottom: 10px;">
                {% if video.filename and video.filename.endswith(('.mp4', '.avi', '.mov', '.mkv', '.webm')) %}
                    <video width="100%" height="180" style="object-fit: cover; border-radius: 5px;"
                           poster="{{ url_for('static', filename='img/video-placeholder.jpg') if video_exists else '' }}">
                        <source src="{{ url_for('static', filename='uploads/' + video.filename) }}" type="video/mp4">
                    </video>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(102, 126, 234, 0.8); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer;"
                         onclick="this.closest('div').querySelector('video').play()">
                        ‚ñ∂
                    </div>
                {% else %}
                    <!-- Fallback je≈õli nie ma pliku -->
                    <div style="background: #f0f0f0; height: 150px; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; color: #667eea; margin-bottom: 10px;">üé•</div>
                            <p style="color: #333; font-size: 14px; margin: 0;">
                                {{ video.original_filename|truncate(20, True) }}
                            </p>
                            <p style="color: #666; font-size: 12px; margin: 5px 0 0 0;">Plik wideo</p>
                        </div>
                    </div>
                {% endif %}
            </div>
            <p style="color: #666; font-size: 12px; margin-bottom: 15px;">
                <i>Za≈ÇƒÖczony plik: {{ video.original_filename|truncate(25, True) }}</i>
            </p>

        {% else %}
            <!-- Inne typy film√≥w -->
            <div style="background: #e8f4fd; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                <p style="color: #3182ce; margin: 0; font-size: 14px;">
                    <a href="{{ video.filename }}" target="_blank" style="color: #3182ce; text-decoration: none; display: block;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">üåê</span>
                            <div>
                                <strong>Link zewnƒôtrzny</strong><br>
                                <span style="font-size: 12px;">{{ video.filename|truncate(30, True) }}</span>
                            </div>
                        </div>
                    </a>
                </p>
            </div>
        {% endif %}

        <!-- Informacje o filmie -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <span style="color: #999; font-size: 12px;">
                {% if video.uploaded_by_name %}
                    <i>üë§ {{ video.uploaded_by_name }}</i>
                {% endif %}
            </span>

            <span style="color: #999; font-size: 12px;">
                {% if video.uploaded_at %}
                    üìÖ {{ video.uploaded_at.strftime('%Y-%m-%d') }}
                {% endif %}
            </span>
        </div>

        <!-- Link do techniki je≈õli istnieje -->
        {% if video.technique_id %}
        <a href="{{ url_for('technique_detail', technique_id=video.technique_id) }}"
           style="display: inline-block; background: #667eea; color: white; padding: 10px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; width: 100%; text-align: center; font-weight: 600; transition: background 0.3s;"
           onmouseover="this.style.background='#5a67d8'"
           onmouseout="this.style.background='#667eea'">
            üëÅÔ∏è Przejd≈∫ do techniki
        </a>
        {% else %}
        <div style="text-align: center; padding: 10px; background: #f7fafc; border-radius: 4px; font-size: 12px; color: #999; border: 1px dashed #ddd;">
            ‚ö†Ô∏è Nie przypisano do techniki
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align: center; padding: 40px; background: #f7fafc; border-radius: 8px; margin-bottom: 40px;">
    <div style="font-size: 48px; color: #ccc; margin-bottom: 15px;">üé¨</div>
    <p style="color: #999; font-size: 16px; margin-bottom: 10px;">
        Brak dodanych film√≥w
    </p>
    <p style="color: #aaa; font-size: 14px;">
        Dodaj pierwszy film do dowolnej techniki!
    </p>
</div>
{% endif %}
<!-- Kategorie -->
<h3 style="margin-top: 40px; margin-bottom: 20px; color: #333;">Kategorie</h3>
{% if categories %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
    {% for category in categories %}
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s;"
         onclick="window.location.href='{{ url_for('techniques', category=category.id) }}'"
         onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.15)'"
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px rgba(0,0,0,0.1)'">

        <h4 style="color: #667eea; margin-bottom: 10px; font-size: 18px;">{{ category.name }}</h4>

        {% if category.description %}
        <p style="color: #666; font-size: 14px; line-height: 1.5;">{{ category.description }}</p>
        {% else %}
        <p style="color: #999; font-size: 14px; font-style: italic;">Brak opisu</p>
        {% endif %}

        <div style="margin-top: 15px; text-align: right;">
            <span style="color: #667eea; font-size: 12px; font-weight: 600;">
                Kliknij aby zobaczyƒá techniki ‚Üí
            </span>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align: center; padding: 40px; background: #f7fafc; border-radius: 8px;">
    <div style="font-size: 48px; color: #ccc; margin-bottom: 15px;">üìÇ</div>
    <p style="color: #999; font-size: 16px; margin-bottom: 10px;">
        Brak kategorii
    </p>
    <p style="color: #aaa; font-size: 14px;">
        Dodaj najpierw kategorie!
    </p>
</div>
{% endif %}

<!-- Dodatkowy CSS dla lepszego wyglƒÖdu -->
<style>
    /* Hover effect dla kart z filmami */
    div[style*="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"]:hover {
        transform: translateY(-5px);
        transition: transform 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }

    /* Responsywno≈õƒá dla ma≈Çych ekran√≥w */
    @media (max-width: 768px) {
        div[style*="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));"] {
            grid-template-columns: 1fr;
        }

        div[style*="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));"] {
            grid-template-columns: 1fr;
        }
    }

    /* Style dla przycisk√≥w play */
    .play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 0, 0, 0.8);
        color: white;
        width: 60px;
        height: 40px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .play-button:hover {
        transform: translate(-50%, -50%) scale(1.1);
        background: rgba(255, 0, 0, 1);
    }
</style>
<!-- Skrypt do odtwarzania film√≥w -->
<script>
    // Odtwarzanie film√≥w po klikniƒôciu w miniaturkƒô
    document.addEventListener('DOMContentLoaded', function() {
        const videos = document.querySelectorAll('video');

        videos.forEach(video => {
            const container = video.parentElement;
            const playButton = container.querySelector('.play-button');

            if (playButton) {
                playButton.addEventListener('click', function() {
                    video.play();
                    this.style.display = 'none';
                });

                video.addEventListener('pause', function() {
                    playButton.style.display = 'flex';
                });

                video.addEventListener('play', function() {
                    playButton.style.display = 'none';
                });
            }
        });
    });
</script>
{% endblock %}